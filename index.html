<!DOCTYPE html>
<html lang="en">

    <head>
  
        <meta charset="utf-8">
        <title>Visualization of a genetic algorithm</title>
        <link rel="stylesheet" href="style.css">
        <style>

            .node rect {
                /* cursor : move; */
                /* fill-opacity : .9; */
                /* shape-rendering : crispEdges; */
                stroke-width : 0;
            }

            .node text {
                pointer-events : none;
                /* text-shadow : 0 1px 0 #fff; */
            }

            .link {
                fill : none;
                /* stroke : #000; */
                stroke-opacity : .05;
            }

            .link-strong {
                fill : none;
                /* stroke : #000; */
                stroke-opacity : .15;
            }

            .link:hover {
                stroke-opacity : .9;
            }

            .link-strong:hover {
                stroke-opacity : .5;
            }

            .rcorners {
                border-radius : 15px;
                border : 2px solid #8AC007;
                padding : 20px;
            }

            .border {
                border : 1px solid rgba( 11,22,33,0.2);
                stroke-opacity : .2;
            }

            .noborder {
                border : 0px;
            }

            #evolution {
                width : 1800px;
                height : 800px;
            }

            #sorttype {
                width : 1800px;
            }

        </style>
  
    </head>

    <body>

        <header>
            <aside>April 30, 2015</aside>
            <p>Karsten Ahnert</p>
        </header>

        <main>

            <h1>Visualization of a genetic algorithm!</h1>

            <p id="evolution" class="border"></p>
            
            <div id="sorttype" class="border">
                <div class="noborder">
                    Sort type:
                    <div class="noborder">
                        <input type="radio" id="unsorted" name="SortType" value="unsorted" checked="true"> <label for="unsorted">Unsorted</label> <br>
                        <input type="radio" id="sorted" name="SortType" value="sorted"> <label for="sorted">Sorted</label> <br> 
                        <input type="radio" id="values" name="SortType" value="value"> <label for="values">Values</label>
                    </div>
                </div>
                <div class="noborder">
                    Color type:
                    <div class="noborder">
                        <input type="radio" id="fitness" name="ColorTyoe" value="fitness" checked="true"><label for="fitness">Fitness</label><br>
                        <input type="radio" id="size" name="ColorTyoe" value="size" ><label for="size">Size</label><br>
                        <input type="radio" id="height" name="ColorTyoe" value="height" ><label for="height">Height</label><br>
                    </div>
                </div>
             </div>
        </main>

        <footer>
            <aside>April 30, 2015</aside>
            <p>Karsten Ahnert</p>
        </footer>
  
    </body>

    <script type="text/javascript" src="third_party/d3.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="third_party/jquery-2.1.3.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="flowchart.js" charset="utf-8"></script>

    <script>

        var evolution_height = $( "#evolution" ).height(), 
            evolution_width  = $( "#evolution" ).width();

        var margin = { top : 5 , right : 5 , bottom : 8 , left : 5} ,
            width = evolution_width - margin.left - margin.right,
            height = evolution_height - margin.top - margin.bottom;

        var formatNumber = d3.format( ",.0f" ) ,
            format = function( d ) { return formatNumber(d) + " TWh"; },
            color = d3.scale.category20();

        var svg = d3.select( "#evolution" ).append( "svg" )
                .attr( "width" , width + margin.left + margin.right )
                .attr( "height" , height + margin.top + margin.bottom )
            .append( "g" )
                .attr( "transform" , "translate(" + margin.left + "," + margin.top + ")" );

        var flowchart  = d3.flowchart()
                .nodeWidth( 10 )
                .nodePadding( [ 10 , 0 ] )
                .dy( 2 )
                .deltax( 30 )
                .size( [ width , height ] );

        var path = flowchart.link();

        var data = {
            "nodes": [
                { "generation" : 0 , "name" : "1" ,  "value" : 1.0 , "formula" : "x*x" } ,
                { "generation" : 0 , "name" : "2" ,  "value" : 0.9 , "formula" : "x*x" } ,
                { "generation" : 0 , "name" : "3" ,  "value" : 0.1 , "formula" : "x*x" } ,
                { "generation" : 1 , "name" : "1" ,  "value" : 1.0 , "formula" : "x*x" } ,
                { "generation" : 1 , "name" : "2" ,  "value" : 0.9 , "formula" : "x*x" } ,
                { "generation" : 1 , "name" : "3" ,  "value" : 0.1 , "formula" : "x*x" } ,
                { "generation" : 2 , "name" : "1" ,  "value" : 1.0 , "formula" : "x*x" } ,
                { "generation" : 2 , "name" : "2" ,  "value" : 0.9 , "formula" : "x*x" } ,
                { "generation" : 2 , "name" : "3" ,  "value" : 0.1 , "formula" : "x*x" }
            ] ,
            "links" : [
                { "source" : 0 , "target" : 3 , "op" : 0 } ,
                { "source" : 1 , "target" : 3 , "op" : 0 } ,
                { "source" : 1 , "target" : 4 , "op" : 1 } ,
                { "source" : 1 , "target" : 5 , "op" : 1 } ,
                { "source" : 3 , "target" : 6 , "op" : 0 } ,
                { "source" : 4 , "target" : 6 , "op" : 0 } ,
                { "source" : 4 , "target" : 7 , "op" : 1 } ,
                { "source" : 4 , "target" : 8 , "op" : 1 }
            ] };

        d3.json( "evol.json" , function( data ) {

            // calculate link positions
            flowchart.nodes( data.nodes )
                .links( data.links )
                .layout();

            // create nodes, hence a group for each node
            var node = svg.append( "g" ).selectAll( ".node" )
                .data( data.nodes )
                .enter().append( "g" )
                    .attr( "class" , "node" )
                    .attr("transform" , function(d) { return "translate(" + d.x + "," + d.y + ")"; });

            // create node color range
            var node_color = d3.scale.linear()
                .domain([1.0 , 0.7 , 0.0 ])
                .range( ["red", "white", "green"] );

            var node_color_size = d3.scale.linear()
                .domain( [ 1 , 10 , 100 ] )
                .range( [ "green" , "white" , "red" ] );
            
            // append a rect to each node
            var rect = node.append( "rect" )
                .attr( "height" , function( d ) { return d.dy; } )
                .attr( "width" , flowchart.nodeWidth() )
                .style( "fill" , function( d ) { return node_color_size( d.size ); } )
                // .style( "fill" , function( d ) { return node_color( d.value ); } )
                .on( "mouseover" , mouseover )
                .on( "mouseout" , mouseout )
                .append( "title" )
                    .text( function( d ) { return format( d.value ); } );

            // create link properties
            // elite, mutation, crossover, reproduce
            var link_color = { "-1" : "red" , "0" : "blue" , "1" : "green" , "2" : "yellow" };

            // create links
            var link = svg.append( "g" ).selectAll( ".link" )
                .data( data.links )
                .enter().append( "path" )
                    .attr( "class" , function( d ) { if( d.op == -1 ) { return "link-strong"; } else { return "link"; } } )
                    .attr( "d" , path )
                    .style( "stroke-width" , function( d ) { return Math.max( 1 , d.dy ); } )
                    .style( "stroke" , function( d ) { return link_color[ d.op ]; } )
                    // .sort(function(a, b) { return b.dy - a.dy; });
        });

        function mouse( e ) {
            return [ e.pageX - rx, e.pageY - ry ];
        }

        function mouseover( d ) {
            console.log( "mouseover" );
            // svg.selectAll("path.link.target-" + d.key)
            //     .classed("target", true)
            //     .each(updateNodes("source", true));

            // svg.selectAll("path.link.source-" + d.key)
            //     .classed("source", true)
            //     .each(updateNodes("target", true));
        }

        function mouseout( d ) {
            console.log( "mouseout" );
            // svg.selectAll("path.link.source-" + d.key)
            //     .classed("source", false)
            //     .each(updateNodes("target", false));

            // svg.selectAll("path.link.target-" + d.key)
            //     .classed("target", false)
            //     .each(updateNodes("source", false));
        }

    </script>


</html>