<!DOCTYPE html>
<html lang="en">

	<head>
  
    	<meta charset="utf-8">
    	<title>d3.js trial</title>
    	<link rel="stylesheet" href="style.css">
    	<script src="../third_party/d3/d3.min.js" charset="utf-8"></script>
    	<script src="script.js"></script>
    	<script src="../third_party/sankey.js"></script>
	   	<style>

			#sankey {
	  			height: 1000px;
			}

			.node rect {
				cursor: move;
				fill-opacity: .9;
				shape-rendering: crispEdges;
			}

			.node text {
			  	pointer-events: none;
			  	text-shadow: 0 1px 0 #fff;
			}

			.link {
			 	fill: none;
			  	stroke: #000;
			  	stroke-opacity: .2;
			}

			.link:hover {
				stroke-opacity: .5;
			}

			.rcorners1 {
	    		border-radius: 15px;
	    		border: 2px solid #8AC007;
	    		padding: 20px;

			}

		</style>
  
	</head>

  	<body>

  		<header>
  			<aside>April 8, 2015</aside>
  			<p>Karsten Ahnert</p>
		</header>

  		<div id="container">
<!--
	  		<h1>Hello world!</h1>

	  		<h2>Path test</h2>

	  		<div class="rcorners1">

		  		<p id="pathtest">
		  			<svg width="800" height="500">
		  				<g transform="translate(20,20)">
		  					<path style="stroke-width: 96.6;" d="M15,348.1C243.25,348.1 243.25,241.5000000000001 471.5,241.5000000000001" class="link"></path>
	  					</g>
		  			</svg>
		  		</p>

  			</div>
-->
	  		<h2>Sankey test</h2>

	  		<p id="sankey"></p>

		</div>

		<footer>
			<aside>April 8, 2015</aside>
			<p>Karsten Ahnert</p>
		</footer>

  		<script>
  			var margin = {top: 1, right: 1, bottom: 6, left: 1},
				width = 2000 - margin.left - margin.right,
				height = 1000 - margin.top - margin.bottom;

			var formatNumber = d3.format(",.0f"),
				format = function(d) { return formatNumber(d) + " TWh"; },
				color = d3.scale.category20();

			var svg = d3.select("#sankey").append("svg")
					.attr("width", width + margin.left + margin.right)
					.attr("height", height + margin.top + margin.bottom)
					.append("g")
					.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

			var sankey = d3.sankey()
				.nodeWidth(15)
				.nodePadding(10)
				.size([width, height]);

			var path = sankey.link();

  		  	var data = {
  		  		"nodes":[
					{"name":"1_1"},
					{"name":"1_2"},
					{"name":"2_1"},
					{"name":"2_2"},
					{"name":"3_1"},
					{"name":"3_2"},
					{"name":"4_1"},
					{"name":"4_2"}
				] ,
				"links" : [
					{"source":0,"target":2,"value":2.0},
					{"source":0,"target":3,"value":1.0},
					{"source":1,"target":2,"value":1.0},
					{"source":1,"target":3,"value":1.0},
					{"source":2,"target":4,"value":1.0},
					{"source":2,"target":4,"value":1.0},
					{"source":3,"target":5,"value":1.0},
					{"source":3,"target":5,"value":1.0}
				] };
			
			// d3.json( "evol.json" , function( data ) {					

				sankey.nodes(data.nodes)
	  				.links(data.links)
	  				.layout(50);

				var link = svg.append("g").selectAll(".link")
	  				.data(data.links)
					.enter().append("path")
	  					.attr("class", "link")
		  				.attr("d", path)
	  					.style("stroke-width", function(d) { return Math.max(1, d.dy ); })
	  					.sort(function(a, b) { return b.dy - a.dy; });

				var node = svg.append("g").selectAll(".node")
	  				.data(data.nodes)
					.enter().append("g")
	  					.attr("class", "node")
	  					.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
					// .call(d3.behavior.drag()
	  		// 			.origin(function(d) { return d; })
	  		// 			.on("dragstart", function() { this.parentNode.appendChild(this); });
	  					// .on("drag", dragmove));

				node.append("rect")
	   				.attr("height", function(d) { return d.dy + 10 ; })
	   				.attr("width", sankey.nodeWidth())
	   				.style("fill", function(d) { return d.color = color(d.name.replace(/ .*/, "")); })
	   				.style("stroke", function(d) { return d3.rgb(d.color).darker(2); })
					.append("title")
	   				.text(function(d) { return d.name + "\n" + format(d.value); });

   			// });
		</script>

	</body>

</html>